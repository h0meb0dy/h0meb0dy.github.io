<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Setup Ubuntu 24.04.1 LTS 28877c5520793115f8272876a2581b2e5068cffa (2024.03.21.)  setup.zsh AnalysisDecoding type section in WebAssembly moduleWasm module은 여러 개의 section들로 구성되어 있다. Module을 decode하는 Mod">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2024-2887 (Type Confusion in WebAssembly)">
<meta property="og:url" content="https://h0meb0dy.github.io/CVE-2024-2887/index.html">
<meta property="og:site_name" content="h0meb0dy">
<meta property="og:description" content="Setup Ubuntu 24.04.1 LTS 28877c5520793115f8272876a2581b2e5068cffa (2024.03.21.)  setup.zsh AnalysisDecoding type section in WebAssembly moduleWasm module은 여러 개의 section들로 구성되어 있다. Module을 decode하는 Mod">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/user-attachments/assets/cf5cf779-44bd-42e6-95d4-a57082ec6c65">
<meta property="og:image" content="https://github.com/user-attachments/assets/df061fd3-a67b-41ac-a0c0-9beeebadc7cd">
<meta property="og:image" content="https://github.com/user-attachments/assets/454e1840-f3f0-4c4f-ad80-dcdb9538f351">
<meta property="article:published_time" content="2024-12-21T03:00:00.000Z">
<meta property="article:modified_time" content="2024-12-21T03:17:52.176Z">
<meta property="article:author" content="Seongjoon Cho">
<meta property="article:tag" content="browser">
<meta property="article:tag" content="chromium">
<meta property="article:tag" content="v8">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/user-attachments/assets/cf5cf779-44bd-42e6-95d4-a57082ec6c65">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CVE-2024-2887 (Type Confusion in WebAssembly)</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0JW360Q5KZ"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-0JW360Q5KZ');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/Escaping-V8-Sandbox-via-RegExp-Bytecode/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://h0meb0dy.github.io/CVE-2024-2887/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://h0meb0dy.github.io/CVE-2024-2887/&text=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://h0meb0dy.github.io/CVE-2024-2887/&is_video=false&description=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2024-2887 (Type Confusion in WebAssembly)&body=Check out this article: https://h0meb0dy.github.io/CVE-2024-2887/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://h0meb0dy.github.io/CVE-2024-2887/&name=CVE-2024-2887 (Type Confusion in WebAssembly)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://h0meb0dy.github.io/CVE-2024-2887/&t=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Decoding-type-section-in-WebAssembly-module"><span class="toc-number">2.1.</span> <span class="toc-text">Decoding type section in WebAssembly module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Root-cause"><span class="toc-number">2.2.</span> <span class="toc-text">Root cause</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proof-of-concept"><span class="toc-number">2.3.</span> <span class="toc-text">Proof of concept</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Patch"><span class="toc-number">2.4.</span> <span class="toc-text">Patch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">3.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebAssembly-type-confusion"><span class="toc-number">3.1.</span> <span class="toc-text">WebAssembly type confusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implement-exploit-primitives"><span class="toc-number">3.2.</span> <span class="toc-text">Implement exploit primitives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Escaping-V8-sandbox-for-getting-RCE"><span class="toc-number">3.3.</span> <span class="toc-text">Escaping V8 sandbox for getting RCE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">4.</span> <span class="toc-text">References</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        CVE-2024-2887 (Type Confusion in WebAssembly)
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Seongjoon Cho</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-12-21T03:00:00.000Z" class="dt-published" itemprop="datePublished">2024-12-21</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/1-day/">1-day</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/browser/" rel="tag">browser</a>, <a class="p-category" href="/tags/chromium/" rel="tag">chromium</a>, <a class="p-category" href="/tags/v8/" rel="tag">v8</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><ul>
<li>Ubuntu 24.04.1 LTS</li>
<li><a target="_blank" rel="noopener" href="https://chromium.googlesource.com/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa">28877c5520793115f8272876a2581b2e5068cffa</a> (2024.03.21.)</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/h0meb0dy/1-day/tree/main/CVE-2024-2887/setup.zsh"><code>setup.zsh</code></a></p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Decoding-type-section-in-WebAssembly-module"><a href="#Decoding-type-section-in-WebAssembly-module" class="headerlink" title="Decoding type section in WebAssembly module"></a>Decoding type section in WebAssembly module</h3><p>Wasm <a target="_blank" rel="noopener" href="https://webassembly.github.io/spec/core/binary/modules.html">module</a>은 여러 개의 <a target="_blank" rel="noopener" href="https://webassembly.github.io/spec/core/binary/modules.html#sections">section</a>들로 구성되어 있다. Module을 decode하는 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/module-decoder-impl.h;l=1668"><code>ModuleDecoderImpl::DecodeModule()</code></a>은 module을 구성하고 있는 각각의 section들에 대하여 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/module-decoder-impl.h;l=417"><code>ModuleDecoderImpl::DecodeSection()</code></a>을 호출한다. <code>ModuleDecoderImpl::DecodeSection()</code>에서는 <code>section_code</code>에 따라 section을 decode하는 함수를 호출하는데, type section의 경우 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/module-decoder-impl.h;l=621"><code>ModuleDecoderImpl::DecodeTypeSection()</code></a>을 호출한다.</p>
<p><code>ModuleDecoderImpl::DecodeTypeSection()</code>에서는 type section에 있는 type들을 module에 추가한다. 하나의 module에 추가할 수 있는 type들의 최대 개수는 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/wasm-limits.h;l=29"><code>kV8MaxWasmTypes</code></a>로 정의되어 있기 때문에 이를 초과하지 않기 위해 총 세 번의 size check를 진행한다 (<a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/module-decoder-impl.h;l=623">1</a>, <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/module-decoder-impl.h;l=635">2</a>, <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/module-decoder-impl.h;l=637">3</a>).</p>
<p>첫 번째로, section에 정의된 type들의 총 개수가 <code>kV8MaxWasmTypes</code>를 초과하지 않는지 확인한다. <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/module-decoder-impl.h;l=1847"><code>consume_count()</code></a>를 호출하여 count가 <code>kV8MaxWasmTypes</code>보다 크면 <code>types_count</code>에 0을 넣고, 그렇지 않으면 type들의 개수를 넣는다. 이때 recursive type group의 경우 한 개의 type으로 취급한다.</p>
<p>두 번째로, recursive type group을 처리할 때 group에 정의된 type들의 개수가 <code>kV8MaxWasmTypes</code>를 초과하지 않는지 확인한다. 마찬가지로 <code>consume_count()</code>를 호출하여 count가 <code>kV8MaxWasmTypes</code>보다 크면 <code>group_size</code>에 0을 넣고, 그렇지 않으면 type들의 개수를 넣는다.</p>
<p>세 번째로, recursive type group의 type들을 module에 추가할 경우에 type들의 총 개수가 <code>kV8MaxWasmTypes</code>를 초과하지 않을지 확인한다. 이전까지 추가된 type들의 개수인 <code>initial_size</code>에 <code>group_size</code>를 더한 값이 <code>kV8MaxWasmTypes</code>보다 크면 error를 발생시키고, 그렇지 않으면 정상적으로 type들을 module에 추가한다.</p>
<h3 id="Root-cause"><a href="#Root-cause" class="headerlink" title="Root cause"></a>Root cause</h3><p>Recursive type group이 아닌 type을 추가할 때는 size check가 존재하지 않는다. 따라서 recursive type group을 이용하여 총 개수를 <code>kV8MaxWasmTypes</code>로 맞춘 뒤에 다른 type을 추가하면 <code>kV8MaxWasmTypes</code>보다 많은 수의 type들을 정의할 수 있다.</p>
<h3 id="Proof-of-concept"><a href="#Proof-of-concept" class="headerlink" title="Proof of concept"></a>Proof of concept</h3><p><a target="_blank" rel="noopener" href="https://github.com/h0meb0dy/1-day/tree/main/CVE-2024-2887/poc_no_rec.js"><code>poc_no_rec.js</code></a></p>
<p><img src="https://github.com/user-attachments/assets/cf5cf779-44bd-42e6-95d4-a57082ec6c65" alt="image"></p>
<p>Recursive type group을 사용하지 않으면 그냥 <code>kV8MaxWasmTypes + 1</code> 만큼의 type들을 정의하려고 시도하는 상황이기 때문에 error가 발생한다.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/h0meb0dy/1-day/tree/main/CVE-2024-2887/poc_rec.js"><code>poc_rec.js</code></a></p>
<p><img src="https://github.com/user-attachments/assets/df061fd3-a67b-41ac-a0c0-9beeebadc7cd" alt="image"></p>
<p><code>kV8MaxWasmTypes</code> 만큼의 type들을 recursive type group으로 묶으면 첫 번째 size check에서 한 개의 type으로 취급되기 때문에 <code>types_count</code>는 2가 된다. Recursive type group의 뒤쪽에 있는 type을 추가할 때는 <code>initial_size</code>가 <code>kV8MaxWasmTypes</code>이지만 size check가 없기 때문에 정상적으로 type이 추가되고 size는 <code>kV8MaxWasmTypes + 1</code>이 된다.</p>
<h3 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://chromium.googlesource.com/v8/v8/+/b852ad701db21d6db5b34e66f4ec1cdccd2ec4d4">[wasm] Check for type-definition count limit</a> (2024.03.21.)</p>
</blockquote>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="WebAssembly-type-confusion"><a href="#WebAssembly-type-confusion" class="headerlink" title="WebAssembly type confusion"></a>WebAssembly type confusion</h3><p>Wasm module의 heap type들은 <code>kV8MaxWasmTypes</code>부터 시작되는 index들을 reserve하고 있고,이 index들은 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/value-type.h;l=61"><code>HeapType::Representation</code></a>에 정의되어 있다.</p>
<p><a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/function-body-decoder-impl.h;l=5097"><code>RefCast</code></a> instruction은 Wasm object를 특정 type으로 cast한다. 이때 object의 type과 cast하려는 target type 간에 type confusion이 발생하지 않는지 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/wasm-subtyping.cc;l=837"><code>IsSameTypeHierarchy()</code></a>를 호출하여 확인한다. <code>IsSameTypeHierarchy()</code>는 인자로 전달된 두 개의 type에 대하여 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/wasm-subtyping.cc;l=99"><code>NullSentinelImpl()</code></a>의 return value가 같으면 <code>true</code>를 return한다.</p>
<p>검사를 통과하면 type casting을 진행한다. 이때 <code>object</code>와 <code>target_type</code>에 따라 세 가지 경우로 나누어 처리하는데, 이 중에서 <code>TypeCheckAlwaysSucceeds()</code>가 <code>true</code>인 경우, <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/function-body-decoder-impl.h;l=4673"><code>TypeCheckAlwaysSucceeds()</code></a>는 내부적으로 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/wasm-subtyping.h;l=74"><code>IsSubtypeOf()</code></a> → <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/wasm-subtyping.cc;l=253"><code>IsSubtypeOfImpl()</code></a>로 들어가고, <code>subtype</code>이 <code>HeapType::Representation</code>에 정의된 index일 경우 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/wasm-subtyping.cc;l=295"><code>IsHeapSubtypeOfImpl()</code></a>로 들어가서, <code>sub_heap</code>이 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/wasm-subtyping.cc;l=329"><code>HeapType::kNone</code></a>일 경우 <code>super_heap</code>에 (거의) 관계없이 <code>true</code>를 return한다.</p>
<p>결론적으로, <code>HeapType::kNone</code>을 <code>IsHeapSubtypeOfImpl()</code>이 <code>true</code>를 return하도록 하는 다른 <code>HeapType</code>(e.g. <code>HeapType::kStruct</code>)으로 cast하려는 경우 <code>TypeCheckAlwaysSucceeds()</code>는 <code>true</code>를 return하고, 이 경우 <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/v8/v8/+/28877c5520793115f8272876a2581b2e5068cffa:src/wasm/graph-builder-interface.cc;l=2180"><code>WasmGraphBuildingInterface::Forward()</code></a>를 호출하여 type casting을 완료한다.</p>
<p>버그를 이용하면 <code>kV8MaxWasmTypes</code>보다 많은 type들을 정의할 수 있기 때문에, <code>HeapType::kNone</code>에 해당하는 type을 다른 type으로 overwrite할 수 있다. 즉, 임의의 type을 다른 <code>HeapType</code>으로 cast할 수 있게 되어 type confusion이 발생한다.</p>
<h3 id="Implement-exploit-primitives"><a href="#Implement-exploit-primitives" class="headerlink" title="Implement exploit primitives"></a>Implement exploit primitives</h3><p><code>kAny</code>(JavaScript object)를 <code>kI31</code>(address)로 cast하면 object의 pointer compression이 적용된 address를 integer type으로 얻을 수 있다 (<code>addrof</code>).</p>
<p><code>kI31</code>(address)을 reference type (pointer)으로 cast하고 dereference하면 V8 sandbox 내부에서 임의의 주소에 저장된 값에 접근할 수 있고, 이 값을 읽으면 arbitrary address read, 값을 쓰면 arbitrary address write primitive가 된다.</p>
<h3 id="Escaping-V8-sandbox-for-getting-RCE"><a href="#Escaping-V8-sandbox-for-getting-RCE" class="headerlink" title="Escaping V8 sandbox for getting RCE"></a>Escaping V8 sandbox for getting RCE</h3><blockquote>
<p><a href="https://h0meb0dy.github.io/Escaping-V8-Sandbox-via-RegExp-Bytecode">Escaping V8 Sandbox via RegExp Bytecode (Chromium &lt; 125.0.6422.60, V8 &lt; 12.5.56)</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/h0meb0dy/1-day/tree/main/CVE-2024-2887/pwn.js"><code>pwn.js</code></a></p>
<p><img src="https://github.com/user-attachments/assets/454e1840-f3f0-4c4f-ad80-dcdb9538f351" alt="image"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://chromereleases.googleblog.com/2024/03/stable-channel-update-for-desktop_26.html">Stable Channel Update for Desktop (Tuesday, March 26, 2024) - Chrome Releases</a></li>
<li><a target="_blank" rel="noopener" href="https://issues.chromium.org/issues/330588502">[Pwn2Own 2024] wasm type confusion from insufficient type section validation - Chromium Issues</a></li>
<li><a target="_blank" rel="noopener" href="https://issues.chromium.org/issues/330575498">[Pwn2Own 2024] v8 wasm type confusion RCE – umbrella bug - Chromium Issues</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zerodayinitiative.com/blog/2024/5/2/cve-2024-2887-a-pwn2own-winning-bug-in-google-chrome">CVE-2024-2887: A Pwn2Own Winning Bug in Google Chrome - Zero Day Initiative</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/rycbar77/CVE-2024-2887">rycbar77&#x2F;CVE-2024-2887 - Github</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Decoding-type-section-in-WebAssembly-module"><span class="toc-number">2.1.</span> <span class="toc-text">Decoding type section in WebAssembly module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Root-cause"><span class="toc-number">2.2.</span> <span class="toc-text">Root cause</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proof-of-concept"><span class="toc-number">2.3.</span> <span class="toc-text">Proof of concept</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Patch"><span class="toc-number">2.4.</span> <span class="toc-text">Patch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">3.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebAssembly-type-confusion"><span class="toc-number">3.1.</span> <span class="toc-text">WebAssembly type confusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implement-exploit-primitives"><span class="toc-number">3.2.</span> <span class="toc-text">Implement exploit primitives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Escaping-V8-sandbox-for-getting-RCE"><span class="toc-number">3.3.</span> <span class="toc-text">Escaping V8 sandbox for getting RCE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">4.</span> <span class="toc-text">References</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://h0meb0dy.github.io/CVE-2024-2887/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://h0meb0dy.github.io/CVE-2024-2887/&text=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://h0meb0dy.github.io/CVE-2024-2887/&is_video=false&description=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2024-2887 (Type Confusion in WebAssembly)&body=Check out this article: https://h0meb0dy.github.io/CVE-2024-2887/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://h0meb0dy.github.io/CVE-2024-2887/&title=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://h0meb0dy.github.io/CVE-2024-2887/&name=CVE-2024-2887 (Type Confusion in WebAssembly)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://h0meb0dy.github.io/CVE-2024-2887/&t=CVE-2024-2887 (Type Confusion in WebAssembly)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2024
    Seongjoon Cho
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
